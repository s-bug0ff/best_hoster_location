**Disclaimer:** 
Этот проект предназачен только для личного использования, пожалуйста, не используйте его в незаконных целях.

# Назначение
Данный скрипт сделан для людей, которые хотят выбрать удачную локацию у хостера для размещения своего VPN или другого сервиса. На данный момент для анализа используется 2 показателя ping (меньше лучше) и traceroute (чем меньше количество "колен" до сервера тем лучше) 

# Использование
### Linux & MacOS
1. Клонируем репозиторий
```
git clone https://github.com/s-bug0ff/best_hoster_location.git
```
2. Переходим в папку проекта 
```
cd best_hoster_location
```
3. Запускаем  скрипт
```
perl best_hoster_location.pl
```

### Windows
1. Клонируем репозиторий
```
git clone https://github.com/s-bug0ff/best_hoster_location.git
```
2. Переходим в папку проекта 
```
cd best_hoster_location
```
3. Запускаем портативный perl
```
.\perl_portable\portableshell.bat
```
4. Запускаем  скрипт
```
perl best_hoster_location.pl
```

### Docker

Использование через докер невозможно, т.к. разные ОС имеют ряд сложностей использованием сети

## Результат выполнения
В папке result появится 2 файла

- result/BEST_*.json - лучшие локации по результату работы скрипта (те которые удовлетворяют условию ping <= max_avg_ping и hops <= max_hops)
- result/FULL_*.json - метрики по всем опрошенным IP адресам.

# Настройки скрипта
 - Файл с настройками находится в папке проекта script_settings.yml

Настройки по умолчанию:
```
hoster_name: "justhost" # название опрашиваемого хостера
number_randomly_prefixes_by_country: 5 # количество подсетей анализируемых в рамках одной страны
number_randomly_taken_ip_from_netblock: 5 # количество IP адресов взятых из одной подсети
number_pings_to_one_ip: 5 # количество пингов к одному IP
max_avg_ping: 60 # максимальный приемлемый пинг до сервера
debug: 1 # включить подробное логгирование
try_update_asn_file: 1 # попытаться загрузить новый файл ASN файл
skip_country_code: ["RU", "GB", "AT", "US", "SC", "SG", "CN", "AE", "TR"] # список двухбуквенных обозначений стран, которые не будут анализироваться
```

Страны по умолчанию исключенные из выборки, выбраны по принципу 
 1. В стране присутствуют ограничения
 2. Обычно до страны большой пинг

Вы можете самостоятельно убрать страну из исключений модифицировав файл script_settings.yml

## Список доступных хостеров
 - Файл со списком доступных хостеров находится в папке проекта db/hosters_asn.yml<br>

На данный момент доступен ограниченный список, буду благодарен за помощь в его наполнении

Так же вы можете самостоятельно добавить хостера, для этого нужно добавить в файл db/hosters_asn.yml новую строчку с записью вида 

```
hoster_name: hoster_asn 
```
Где hoster_name - любое удобное вам название, а hoster_asn - номер взятый с сайта https://ipinfo.io/

Так же можно подложить уже загруженный файл с информацией о хостере в папку info_by_asn/hoster_asn.json.

После этого поправить в script_settings.yml строчку 
`hoster_name: "justhost"` на `hoster_name: "hoster_name"`



# Допущения принятые в скрипте и другая не очень важная информация:
1. Для уменьшения времени работы скрипта traceroute делается только к 1му IP внутри страны. В будущем возможно добавлю возможность регулировать это через конфиг
2. Сайт https://ipinfo.io/ с которого тянется информация о подсетях хостеров имеет свои ограничения
   - Количество выгрузок в день ограничено, при превышении скрипт использует уже сохраненные данные (info_by_asn/*.json)
   - Сайт предоставляет только демо информацию о хостерах, т.е. нет никаких гарантий что мы получаем полный список стран и ip адресов
   - если я правильно понимаю, хостеры могут работать на сетях другого хостера, (например PQ), т.е. возможна обратная ситуация когда скрипт получает локации и ip адреса недоступные у проверяемого хостера (но это не точно)
   - Скрипт рандомно выбирает несколько подсетей и IP адресов внутри этой подсети (по умолчанию 5 и 5) что может привести, при определенном состоянии "удачи", к тому что хорошая локация будет забракована потому что ни один из IP адресов не ответил на пинг запрос (при тестировании не встречал подобной ситуации, но в целом она возможна). Для избежания данной ситуации можно в конфиге увеличить количество подсетей и IP адресов(осторожно, это увеличит время работы скрипта), ну или бафнуть свою удачу :-)